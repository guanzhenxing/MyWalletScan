import{r as g,j as t}from"./index-aeda1e87.js";import{C as R,D as Ue,E as oe,F as ie}from"./getScore-3c6d58b9.js";import{U as Be,D as Me,e as Le}from"./save_excel-2f1f7d40.js";import{a as P,C as ze}from"./axios-057734f1.js";import{F as M}from"./index-9f5a0d13.js";import{M as ce,P as de,D as ue}from"./DeleteOutlined-67da6863.js";import{S as me}from"./index-cd8267bc.js";import{B as N,E as Pe}from"./EditOutlined-3f21ada2.js";import{I as re,E as $e,a as Ve}from"./Pagination-637f931d.js";import{S as T}from"./index-c463ec7e.js";import{T as f,a as Je}from"./index-e00a8a8b.js";import{L as Ke}from"./index-06592163.js";import{S as He,n as z}from"./SyncOutlined-80c16cfc.js";import{m as he}from"./index-a00c1fcb.js";import{S as Re}from"./SlidersOutlined-a42c1d94.js";import"./useFlexGapSupport-69780201.js";import"./FileSaver.min-b2a08254.js";import"./PlusOutlined-74a5f9c7.js";import"./row-da0b9f45.js";import"./responsiveObserver-953ba023.js";import"./col-bebaa28a.js";import"./index-d904ea6a.js";import"./Sider-20598f97.js";import"./useNotification-4ae4ff01.js";async function ye(n,_){try{let d=`https://api.basescan.org/api?module=account&action=balance&address=${n}&tag=latest&apikey=${_}`;const j=await P.get(d);return{balance:parseFloat(R(j.data.result)).toFixed(4)}}catch(d){return console.error(d),{balance:"Error"}}}function Ye(n){return`${n.getUTCFullYear()}-${n.getUTCMonth()+1}-${n.getUTCDate()}`}function Qe(n){n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),n.setUTCDate(n.getUTCDate()+4-(n.getUTCDay()||7));let _=new Date(Date.UTC(n.getUTCFullYear(),0,1)),d=Math.ceil(((n-_)/864e5+1)/7);return n.getUTCFullYear()+"W"+d}function We(n){return n.getUTCFullYear()+"-"+(n.getUTCMonth()+1)}function qe(n){const _=new Date(n),d=8,j=new Date(_.getTime()+d*3600*1e3),S=new Date,x=new Date(S.getTime()+d*3600*1e3)-j,c=Math.floor(x/(1e3*60*60)),p=Math.floor(c/24);return p>0?`${p} 天前`:c>0?`${c} 小时前`:"刚刚"}const Ge=async()=>{try{const n={method:"GET",url:"https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD"};return(await P.request(n)).data.USD}catch(n){return console.log(n),"/"}};async function ge(n,_){try{let d=new Set,j=new Set,S=new Set;n=n.toLowerCase();let A=`https://api.basescan.org/api?module=account&action=txlist&address=${n}&startblock=0&endblock=9999999999&page=1&offset=9999&sort=asc&apikey=${_}`,c=(await P.get(A)).data.result;c=c.filter(w=>w.from===n);let p=c.map(w=>w.to);p=[...new Set(p)];let C=c.map(w=>new Date(w.timeStamp*1e3));const U=C[C.length-1];C.forEach(w=>{d.add(Ye(w)),j.add(Qe(w)),S.add(We(w))});const F=c.reduce((w,O)=>w+parseFloat(O.gasPrice)*parseFloat(O.gasUsed),0),L=R(F),$=c.reduce((w,O)=>w+parseFloat(R(O.value)),0),K=await Ge(),Y=$*K,H=c.length,V=qe(U),Q=d.size,W=j.size,q=S.size,G=p.length;return{base_tx_amount:H,base_last_tx:V,dayActivity:Q,weekActivity:W,monthActivity:q,contractActivity:G,totalFee:parseFloat(L).toFixed(4),totalExchangeAmount:parseFloat(Y).toFixed(2)}}catch(d){return console.error(d),{base_tx_amount:"Error",base_last_tx:"Error",dayActivity:"Error",weekActivity:"Error",monthActivity:"Error",contractActivity:"Error",totalFee:"Error",totalExchangeAmount:"Error"}}}async function xe(n,_){var d,j;try{let S=6,A=`https://api.basescan.org/api?module=account&action=tokenbalance&contractaddress=0xd9aaec86b65d86f6a7b5b1b0c42ffa531710b6ca&address=${n}&tag=latest&apikey=${_}`;const x=await P.get(A),c=parseFloat(((d=x.data)==null?void 0:d.result)/Math.pow(10,S)).toFixed(2);let p=`https://api.basescan.org/api?module=account&action=tokenbalance&contractaddress=0x833589fcd6edb6e08f4c7c32d4f71b54bda02913&address=${n}&tag=latest&apikey=${_}`;const C=await P.get(p),U=parseFloat(((j=C.data)==null?void 0:j.result)/Math.pow(10,S)).toFixed(2);return{USDbC:c,USDC:U}}catch(S){return console.error(S),{USDbC:"Error",USDC:"Error"}}}async function pe(n,_){try{n=n.toLowerCase();let d=`https://api.basescan.org/api?module=account&action=txlist&address=${n}&startblock=0&endblock=9999999999&page=1&offset=9999&sort=asc&apikey=${_}`;const A=(await P.get(d)).data.result.filter(p=>p.from===n&&p.to===n&&(p==null?void 0:p.value)>1);if(A.length===0)return{l1Tol2Times:0,l1Tol2Amount:0};const x=A==null?void 0:A.length,c=A.reduce((p,C)=>p+parseFloat(R(C.value)),0).toFixed(3);return{l1Tol2Times:x,l1Tol2Amount:c}}catch(d){return console.error(d),{l1Tol2Times:"Error",l1Tol2Amount:"Error"}}}const{Content:Xe}=Ke,{TextArea:Ze}=re;function Tt(){const[n,_]=g.useState(0),[d,j]=g.useState(0),[S,A]=g.useState(!1),[x,c]=g.useState([]),[p,C]=g.useState(!1),[U]=M.useForm(),[F,L]=g.useState([]);M.useForm(),g.useState(!1);const[$,K]=g.useState(!1),[Y,H]=g.useState(!1),[V,Q]=g.useState(!1),[W,q]=g.useState([]),[G,w]=g.useState(0),[O]=M.useForm(),[I,le]=g.useState(localStorage.getItem("base_api_key")),[be,X]=g.useState(!1),fe=()=>{Q(!V)},_e=()=>{localStorage.setItem("base_api_key",O.getFieldsValue().base),X(!1),le(localStorage.getItem("base_api_key"))};g.useEffect(()=>{const e=localStorage.getItem("base_api_key");e&&(le(e),O.setFieldsValue(e))},[]);const ke=()=>V?t.jsx($e,{}):t.jsx(Ve,{});g.useEffect(()=>{const e=()=>{w(window.innerHeight-210)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]);const we=async()=>{if(!F.length){z.error({message:"错误",description:"请先选择要刷新的地址"},2);return}K(!0);try{let a=0,l=[];const r=[...x],k=()=>{for(;a<2&&l.length>0;){const h=l.shift();a+=1,h().finally(()=>{a-=1,k()})}l.length>0&&setTimeout(k,2500)};for(let h of F){const b=r.findIndex(s=>s.key===h);if(b!==-1){const s=r[b];l.push(()=>(s.base_eth_balance=null,ye(s.address,I).then(({balance:o})=>{s.base_eth_balance=o,c([...r]),localStorage.setItem("base_addresses",JSON.stringify(r))}))),l.push(async()=>(s.base_usdbc_balance=null,s.base_usdc_balance=null,xe(s.address,I).then(({USDbC:o,USDC:y})=>{s.base_usdbc_balance=o,s.base_usdc_balance=y,c([...r]),localStorage.setItem("base_addresses",JSON.stringify(r))}))),l.push(()=>(s.base_tx_amount=null,s.base_last_tx=null,s.dayActivity=null,s.weekActivity=null,s.monthActivity=null,s.contractActivity=null,s.totalFee=null,ge(s.address,I).then(({base_tx_amount:o,base_last_tx:y,dayActivity:i,weekActivity:E,monthActivity:v,contractActivity:B,totalFee:m,totalExchangeAmount:u})=>{s.base_tx_amount=o,s.base_last_tx=y,s.dayActivity=i,s.weekActivity=E,s.monthActivity=v,s.contractActivity=B,s.totalFee=m,s.totalExchangeAmount=u,c([...r]),localStorage.setItem("base_addresses",JSON.stringify(r))}))),l.push(()=>(s.eth_balance=null,oe(s.address,"ethereum").then(o=>{s.eth_balance=o,c([...r]),localStorage.setItem("base_addresses",JSON.stringify(r))}))),l.push(()=>(s.eth_tx_amount=null,ie(s.address,"ethereum").then(o=>{s.eth_tx_amount=o,c([...r]),localStorage.setItem("base_addresses",JSON.stringify(r))}))),l.push(()=>(s.l1Tol2Times=null,s.l1Tol2Amount=null,pe(s.address,I).then(({l1Tol2Times:o,l1Tol2Amount:y})=>{s.l1Tol2Times=o,s.l1Tol2Amount=y,c([...r]),localStorage.setItem("base_addresses",JSON.stringify(r))})))}}k()}catch(e){z.error({message:"错误",description:e.message},2)}finally{K(!1),L([]),he.success("刷新成功")}},Se=async()=>{try{A(!0),C(!1);const l=(await U.validateFields()).addresses.split(`
`).map(i=>{const[E,v]=i.split(",");return{address:E.trim(),name:v?v.trim():""}}),r=l.map(i=>i.address),k=l.map(i=>i.name);j(r.length);const h=[...x],b=3;let s=0,o=[];_(0);const y=()=>{for(;o.length>0&&s<b;){const i=o.shift();s+=1,i().finally(()=>{s-=1,y()})}};for(let i of r){i=i.trim();let E=k[r.indexOf(i)];if(i.length!==42){z.error({message:"错误",description:"请输入正确的地址"});continue}let v=()=>new Promise((u,D)=>{_(J=>J+1),u()});const B=h.findIndex(u=>u.address===i),m=B!==-1?h[B]:{key:h.length.toString(),address:i,name:E,eth_balance:null,eth_tx_amount:null,base_eth_balance:null,base_last_tx:null,base_tx_amount:null,base_usdbc_balance:null,base_usdc_balance:null,base_usdtBalance:null,dayActivity:null,weekActivity:null,monthActivity:null,l1Tol2Times:null,l1Tol2Amount:null,l2Tol1Times:null,l2Tol1Amount:null,contractActivity:null,totalFee:null,totalExchangeAmount:null};B===-1&&h.push(m),o.push(()=>ye(i,I).then(({balance:u})=>{m.base_eth_balance=u})),o.push(()=>xe(i,I).then(({USDbC:u,USDC:D})=>{m.base_usdbc_balance=u,m.base_usdc_balance=D})),o.push(()=>oe(i,"ethereum").then(u=>{m.eth_balance=u})),o.push(()=>ie(i,"ethereum").then(u=>{m.eth_tx_amount=u})),o.push(()=>ge(i,I).then(({base_tx_amount:u,base_last_tx:D,dayActivity:J,weekActivity:ee,monthActivity:te,contractActivity:ae,totalFee:se,totalExchangeAmount:ne})=>{m.base_tx_amount=u,m.base_last_tx=D,m.dayActivity=J,m.weekActivity=ee,m.monthActivity=te,m.contractActivity=ae,m.totalFee=se,m.totalExchangeAmount=ne})),o.push(()=>pe(i,I).then(({l1Tol2Times:u,l1Tol2Amount:D})=>{m.l1Tol2Times=u,m.l1Tol2Amount=D})),o.push(v),y()}for(;s>0||o.length>0;)await new Promise(i=>setTimeout(i,1e3));c(h),localStorage.setItem("base_addresses",JSON.stringify(h))}catch(e){z.error({message:"错误",description:e.message})}finally{A(!1),_(0),U.resetFields(),L([]),he.success("地址添加成功")}},Te=()=>{if(I===null){z.error({message:"请先填写API Key",description:"完成API配置 再添加地址",duration:10});return}C(!0)},Ae=()=>{Le(x,"walletInfo")};g.useEffect(()=>{H(!0);const e=localStorage.getItem("base_addresses");setTimeout(()=>{H(!1)},500),e&&(c(JSON.parse(e)),q(JSON.parse(e)))},[]),g.useEffect(()=>{const e=[...x];for(const a of e)setTimeout(async()=>{const l=await Ue(a);a.base_score=l,e.every(k=>k.zk_score!==void 0)&&c(e)},0)},[W]);const je=e=>{c(x.filter(a=>a.key!==e)),localStorage.setItem("base_addresses",JSON.stringify(x.filter(a=>a.key!==e)))},Ce=()=>{if(!F.length){z.error({message:"错误",description:"请先选择要删除的地址"},2);return}c(x.filter(e=>!F.includes(e.key))),localStorage.setItem("base_addresses",JSON.stringify(x.filter(e=>!F.includes(e.key)))),L([])},ve={selectedRowKeys:F,onChange:e=>{L(e)}},Ee=()=>{C(!1)},[Fe,Z]=g.useState(null),Ie=[{title:"#",key:"index",align:"center",render:(e,a,l)=>l+1,width:70},{title:"备注",dataIndex:"name",key:"name",align:"center",render:(e,a)=>a.key===Fe?t.jsx(re,{placeholder:"请输入备注",defaultValue:e,onPressEnter:r=>{a.name=r.target.value,c([...x]),localStorage.setItem("base_addresses",JSON.stringify(x)),Z(null)}}):t.jsxs(t.Fragment,{children:[t.jsx(Je,{color:"blue",onClick:()=>Z(a.key),children:e}),!e&&t.jsx(N,{shape:"circle",icon:t.jsx(Pe,{}),size:"small",onClick:()=>Z(a.key)})]}),width:90},{title:t.jsxs("span",{children:["钱包地址",t.jsx("span",{onClick:fe,style:{marginLeft:8,cursor:"pointer"},children:ke()})]}),dataIndex:"address",key:"address",align:"center",render:(e,a)=>V?"***":e,width:360},{title:"ETH",key:"eth_group",className:"zks_eth",children:[{title:"ETH",dataIndex:"eth_balance",key:"eth_balance",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:80},{title:"Tx",dataIndex:"eth_tx_amount",key:"eth_tx_amount",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:80}]},{title:"Base Mainnet",key:"zks_era_group",className:"zks_era",children:[{title:"ETH",dataIndex:"base_eth_balance",key:"base_eth_balance",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:70},{title:"USDC",dataIndex:"base_usdc_balance",key:"base_usdc_balance",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:70},{title:"USDbC",dataIndex:"base_usdbc_balance",key:"base_usdbc_balance",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:70},{title:"Tx",dataIndex:"base_tx_amount",key:"base_tx_amount",align:"center",sorter:(e,a)=>e.base_tx_amount-a.base_tx_amount,render:(e,a)=>{if(e===null)return t.jsx(T,{});const l=Math.log(e),r=Math.log(1),k=Math.log(100),h=(l-r)/(k-r),b=.1,y=`rgba(173, 216, 230, ${h*(1-b)+b})`;return{children:e,props:{style:{background:y}}}},width:60},{title:"最后交易",dataIndex:"base_last_tx",key:"base_last_tx",align:"center",render:(e,a)=>{let l="inherit";return e===null?t.jsx(T,{}):(e!=null&&e.includes("天")&&parseInt(e)>7?l="red":l="#1677ff",t.jsx("a",{href:"https://basescan.org/address/"+a.address,target:"_blank",style:{color:l},children:e}))},width:90},{title:"官方桥跨链Tx数",key:"cross_chain_tx_count_group",children:[{title:"L1->L2",dataIndex:"l1Tol2Times",key:"l1Tol2Times",align:"center",sorter:(e,a)=>e.l1Tol2Times-a.l1Tol2Times,render:(e,a)=>e===null?"/":e,width:65},{title:"L2->L1",dataIndex:"l2Tol1Times",key:"l2Tol1Times",align:"center",render:(e,a)=>e===null?"/":e,width:55}]},{title:"官方桥跨链金额",key:"cross_chain_amount_group",children:[{title:"L1->L2",dataIndex:"l1Tol2Amount",key:"l1Tol2Amount",align:"center",render:(e,a)=>e===null?"/":e,width:55},{title:"L2->L1",dataIndex:"l2Tol1Amount",key:"l2Tol1Amount",align:"center",render:(e,a)=>e===null?"/":e,width:55}]},{title:"活跃统计",key:"activity_stats_group",children:[{title:"日",dataIndex:"dayActivity",key:"dayActivity",align:"center",sorter:(e,a)=>e.dayActivity-a.dayActivity,render:(e,a)=>e===null?t.jsx(T,{}):e,width:55},{title:"周",dataIndex:"weekActivity",key:"weekActivity",align:"center",sorter:(e,a)=>e.weekActivity-a.weekActivity,render:(e,a)=>e===null?t.jsx(T,{}):e,width:50},{title:"月",dataIndex:"monthActivity",key:"monthActivity",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:50},{title:"不同合约",dataIndex:"contractActivity",key:"contractActivity",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:85},{title:"金额(U)",dataIndex:"totalExchangeAmount",key:"totalExchangeAmount",align:"center",sorter:(e,a)=>e.totalExchangeAmount-a.totalExchangeAmount,render:(e,a)=>{if(e===null)return"/";const l=Math.log(e),r=Math.log(1),k=Math.log(100),h=(l-r)/(k-r),b=.1,y=`rgba(211, 211, 211, ${h*(1-b)+b})`;return{children:e,props:{style:{background:y}}}},width:90},{title:"FeeΞ",dataIndex:"totalFee",key:"totalFee",align:"center",render:(e,a)=>e===null?t.jsx(T,{}):e,width:80}]}]},{title:"评分",dataIndex:"base_score",key:"base_score",align:"center",sorter:(e,a)=>e.base_score-a.base_score,render:(e,a)=>{if(e===null)return t.jsx(T,{});const l=Math.log(e),r=Math.log(1),k=Math.log(100),h=(l-r)/(k-r),b=.1,y=`rgba(240, 121, 78, ${h*(1-b)+b})`;return{children:e,props:{style:{background:y}}}},width:70},{title:"操作",key:"action",align:"center",render:(e,a)=>t.jsx(me,{size:"small",children:t.jsx(de,{title:"确认删除？",onConfirm:()=>je(a.key),children:t.jsx(N,{icon:t.jsx(ue,{})})})}),width:70}];return t.jsx("div",{children:t.jsxs(Xe,{children:[t.jsx(ce,{title:"批量添加地址",open:p,onOk:Se,onCancel:Ee,okButtonProps:{loading:$},okText:"添加地址",cancelText:"取消",children:t.jsx(M,{form:U,layout:"vertical",children:t.jsx(M.Item,{label:"地址",name:"addresses",rules:[{required:!0}],children:t.jsx(Ze,{placeholder:"请输入地址，每行一个  要添加备注时放在地址后以逗号(,)间隔",style:{width:"500px",height:"200px"}})})})}),t.jsx(ce,{title:t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"更换API Key"}),t.jsx("div",{style:{fontSize:"12px",color:"#888"},children:t.jsx(me,{children:t.jsx(N,{type:"link",onClick:()=>window.open("https://basescan.org/myapikey","_blank"),children:"注册Basescan API"})})})]}),open:be,onOk:_e,onCancel:()=>X(!1),okText:"确定",cancelText:"取消",children:t.jsx(M,{form:O,layout:"horizontal",children:t.jsx(M.Item,{label:"Base",name:"base",children:t.jsx(re,{placeholder:"请输入basescan API Key"})})})}),t.jsx(T,{spinning:Y,children:t.jsx(f,{rowSelection:ve,dataSource:x,pagination:!1,bordered:!0,style:{marginBottom:"0px",zIndex:2},size:"small",columns:Ie,scroll:{y:G},summary:e=>{let a=0,l=0,r=0,k=0,h=0,b=0,s=0,o=0,y=0,i=0,E=0,v=0;e.forEach(({eth_balance:m,base_eth_balance:u,base_usdc_balance:D,base_usdbc_balance:J,base_tx_amount:ee,totalFee:te,dayActivity:ae,weekActivity:se,monthActivity:ne,contractActivity:Oe,totalExchangeAmount:De,base_score:Ne})=>{a+=Number(m),l+=Number(u),r+=Number(D),k+=Number(J),h+=Number(te),b+=Number(ee),s+=Number(ae),o+=Number(se),y+=Number(ne),i+=Number(Oe),E+=Number(De),v+=Number(Ne)}),b=b/e.length,s=s/e.length,o=o/e.length,y=y/e.length,i=i/e.length,E=E/e.length,v=v/e.length;const B=Array(5).fill().map((m,u)=>t.jsx(f.Summary.Cell,{index:u+11},u));return t.jsx(t.Fragment,{children:t.jsxs(f.Summary.Row,{children:[t.jsx(f.Summary.Cell,{index:0,colSpan:4,children:"总计"}),t.jsx(f.Summary.Cell,{index:4,children:a.toFixed(4)}),t.jsx(f.Summary.Cell,{index:5}),t.jsx(f.Summary.Cell,{index:8,children:l.toFixed(4)}),t.jsx(f.Summary.Cell,{index:9,children:r.toFixed(2)}),t.jsx(f.Summary.Cell,{index:10,children:k.toFixed(2)}),t.jsxs(f.Summary.Cell,{index:11,children:["-",b.toFixed(0),"-"]}),B,t.jsxs(f.Summary.Cell,{index:17,children:["-",s.toFixed(0),"-"]}),t.jsxs(f.Summary.Cell,{index:18,children:["-",o.toFixed(0),"-"]}),t.jsxs(f.Summary.Cell,{index:19,children:["-",y.toFixed(0),"-"]}),t.jsxs(f.Summary.Cell,{index:20,children:["-",i.toFixed(0),"-"]}),t.jsxs(f.Summary.Cell,{index:21,children:["-",E.toFixed(0),"-"]}),t.jsx(f.Summary.Cell,{index:22,children:h.toFixed(4)}),t.jsxs(f.Summary.Cell,{index:23,children:["-",v.toFixed(0),"-"]}),t.jsx(f.Summary.Cell,{index:24})]})})},footer:()=>t.jsx(ze,{children:t.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",gap:"20px"},children:[t.jsx(N,{type:"primary",onClick:we,loading:$,size:"large",style:{width:"20%"},icon:t.jsx(He,{}),children:$?"正在刷新":"刷新选中地址"}),t.jsx(N,{type:"primary",onClick:Te,size:"large",style:{width:"20%"},icon:t.jsx(Be,{}),loading:S,children:S?`添加中 进度:(${n}/${d})`:"添加地址"}),t.jsx(N,{type:"primary",onClick:()=>{X(!0)},size:"large",style:{width:"20%"},icon:t.jsx(Re,{}),children:"更换API KEY"}),t.jsx(de,{title:"确认删除"+F.length+"个地址？",onConfirm:Ce,children:t.jsx(N,{type:"primary",danger:!0,size:"large",style:{width:"20%"},icon:t.jsx(ue,{}),children:"删除选中地址"})}),t.jsx(N,{type:"primary",icon:t.jsx(Me,{}),size:"large",style:{width:"8%"},onClick:Ae})]})})})})]})})}export{Tt as default};
